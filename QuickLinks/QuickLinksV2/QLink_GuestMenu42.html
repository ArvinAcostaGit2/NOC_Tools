<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quick Links â€“ Guest View</title>
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  
<style>
    /* ---------------------------------- */
    /* CSS Variables & Global Reset       */
    /* ---------------------------------- */
    :root{
        --bg:#f5f5f5;
        --card:#fff;
        --muted:#666;
        --accent:#111;
        --shadow:0 2px 5px rgba(0,0,0,0.12);
        --primary-color: #007bff;
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
        background:var(--bg);
        color:#222;
        -webkit-font-smoothing:antialiased;
        -moz-osx-font-smoothing:grayscale;
    }
    
    /* ---------------------------------- */
    /* RIBBON UX STYLES                   */
    /* ---------------------------------- */
    .ribbon {
      background: var(--bg);
      border-bottom: 1px solid #ccc;
    }

    .ribbon-tabs-wrapper {
      list-style: none;
      display: flex; /* Use flex to put fixed and scrollable tabs side-by-side */
      margin: 0;
      padding: 0; 
      background: #ddd;
      border-bottom: 1px solid #bbb;
      white-space: nowrap; 
    }
    
    /* Fixed Tab Container (for Welcome/All Links) */
    .ribbon-tabs-fixed {
        list-style: none;
        display: flex;
        margin: 0;
        padding: 0;
        flex-shrink: 0; /* Prevents shrinking */
    }
    
    /* Scrollable Dynamic Tabs Container */
    .ribbon-tabs-scrollable {
      list-style: none;
      display: flex;
      margin: 0;
      padding: 0 16px; /* Padding for the scroll area */
      overflow-x: auto; 
      background: #ddd;
      white-space: nowrap; 
      scrollbar-width: none;
      flex-grow: 1; /* Takes up remaining space */
      border-left: 1px solid #bbb; /* Visual separation from fixed tab */
    }
    
    .ribbon-tabs-scrollable::-webkit-scrollbar { 
      display: none; /* Chrome, Safari, Opera */
    }

    /* Common Tab Styles */
    .ribbon-tabs-fixed .tab, 
    .ribbon-tabs-scrollable .tab {
      padding: 10px 20px;
      cursor: pointer;
      user-select: none;
      font-size: 14px;
      border-right: 1px solid #bbb;
      transition: background 0.1s ease;
      flex-shrink: 0; 
      display: flex;
      align-items: center;
      gap: 6px; 
      background: #ddd; /* Default background for all tabs */
    }

    /* Active Tab Styles - Fixed */
    .ribbon-tabs-fixed .tab.active {
      background: var(--card);
      font-weight: 600;
      border-bottom: 1px solid var(--card);
      margin-bottom: -1px; 
    }
    
    /* Active Tab Styles - Scrollable */
    .ribbon-tabs-scrollable .tab.active {
      background: var(--card);
      font-weight: 600;
      border-bottom: 1px solid var(--card);
      margin-bottom: -1px; 
    }
    
    .ribbon-tabs-scrollable .tab:hover:not(.active) {
        background: #e5e5e5;
    }

    .ribbon-panels {
      background: var(--card);
      min-height: 200px;
      padding: 10px 16px; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .panel {
      display: none;
      padding: 10px 0;
    }

    .panel.active {
      display: block;
    }
    
    /* ---------------------------------- */
    /* Link List Styles                   */
    /* ---------------------------------- */
    .link-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .link-list-item {
        margin-bottom: 8px;
        border-bottom: 1px solid #eee;
    }
    
    .link-item-anchor {
        display: flex;
        align-items: center;
        padding: 10px 0;
        text-decoration: none;
        color: inherit;
        position: relative;
        transition: background-color .15s ease;
        word-break: break-word;
    }
    .link-item-anchor:hover {
        background-color: #fcfcfc;
    }

    .icon {
        flex-shrink: 0;
        font-size: 18px;
        font-weight: 900;
        color: #111;
        width: 36px;
        height: 36px;
        border-radius: 6px;
        background: #e9e9e9;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
    }

    .icon img {
        width: 24px;
        height: 24px;
        object-fit: contain;
    }
    .icon.has-favicon {
        font-size: 0;
    }
    
    .link-text {
        overflow: hidden;
        flex-grow: 1;
    }
    
    .link-text .title{
        font-size: 15px;
        font-weight: 500;
        color: #111;
        line-height: 1.2;
    }
    .link-text .url{
        font-size: 11px;
        color: var(--muted); 
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis; 
        width: 100%;
        display: block;
    }
    
    /* ---------------------------------- */
    /* Header & Other Styles              */
    /* ---------------------------------- */
    header{
        background:var(--accent);
        color:#fff;
        padding:10px 16px;
    }
    header h1{
        margin:0;
        font-size:18px;
        font-weight:600;
    }
    .container-custom{
        max-width:800px; 
        margin:0 auto; 
        padding:0;
    }

    .empty{
        padding:26px;
        border-radius:8px;
        background:#f8f8f8;
        text-align:center;
        color:var(--muted);
    }
    .text-tip {
        margin: 20px 16px 60px;
        font-size:13px;
        color: var(--muted);
    }

    /* --- WELCOME TAB STYLES (Cleaned up) --- */
    .welcome-panel-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 250px; 
        text-align: center;
        padding: 50px 20px;
        border-radius: 8px;
        background: #fdfdfd; 
    }
    .welcome-panel-content h2 {
        font-size: 32px;
        font-weight: 700;
        color: var(--accent);
    }
    .welcome-clock {
        font-size: 18px;
        color: var(--muted);
        font-weight: 500;
        margin-bottom: 20px;
    }

    /* New/Updated rules for the Logo/Welcome container */
    .logo-title-container {
        display: flex;
        flex-direction: column; /* Stack logo on top of title */
        align-items: center;
        margin-bottom: 10px;
    }
    .logo-title-container img {
        margin-bottom: 10px; /* Space between logo and 'Welcome!' */
    }
    .logo-title-container h2 {
        margin-bottom: 0; /* Remove default margin on the title */
    }
    .welcome-panel-content p {
        color: var(--muted); /* Move paragraph color style here */
    }
</style>
</head>
<body>
<header>
  <div class="container-fluid">
    <div class="row align-items-center justify-content-between">
      <div class="col-auto">
        <h1>Quick Links (Guest View)</h1>
      </div>
      <div class="col-auto">
        <div style="color:#ddd;font-size:13px;">Tools & Idea by | Arvin Acosta</div>
      </div>
    </div>
  </div>
</header>

<main class="container-custom" role="main">
    <div class="ribbon">
        <div class="ribbon-tabs-wrapper">
            <ul class="ribbon-tabs-fixed" id="fixedCategoryTab"></ul> 
            
            <ul class="ribbon-tabs-scrollable" id="scrollableCategoryTabs"></ul> 
        </div>

        <div class="ribbon-panels" id="linksContainer">
            
            <div class="panel" id="panel-ALL_LINKS_VIEW">
                <ul class="link-list">
                    <div class="welcome-panel-content">
                        <div class="logo-title-container"> 
                            <img src="https://www.google.com/s2/favicons?domain=eperformax.com" alt="Welcome Logo" width="64" height="64">
                            <h2>Welcome!</h2>
                        </div>
                        <div id="welcomeClock" class="welcome-clock">Loading Clock...</div>
                        <p>This is a **read-only** view of the company's quick links. Click on a category tab above to view links.</p>
                    </div>
                </ul>
            </div>
        </div>
    </div>
    <div class="text-tip">Tip: Click a category tab to switch views. Click a link to open. **Scroll the dynamic tabs left/right using your mouse wheel!**</div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<script>
// ======================
// CONSTANTS
// ======================
const ALL_LINKS_VIEW = 'ALL_LINKS_VIEW'; 
const EPERFORMAX_ICON_URL = 'https://www.google.com/s2/favicons?domain=eperformax.com';

// ======================
// DATABASE
// ======================
const DB_NAME = 'QuickLinksDB';
const DB_VERSION = 1;
const STORE_NAME = 'links';

let db;

function openDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onerror = (event) => {
            console.error("Database error:", event.target.errorCode);
            resolve(null); 
        };

        request.onsuccess = (event) => {
            db = event.target.result;
            resolve(db);
        };

        request.onupgradeneeded = (event) => {
            db = event.target.result;
            if (!db.objectStoreNames.contains(STORE_NAME)) {
                const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                objectStore.createIndex('category', 'category', { unique: false });
                objectStore.createIndex('sortOrder', 'sortOrder', { unique: false });
            }
        };
    });
}

// ======================
// STATE & DATA LOADING
// ======================
let allLinks = [];
let tooltipInstances = [];
let activeCategory = ALL_LINKS_VIEW;

/**
 * Loads all links from IndexedDB and sorts them.
 */
async function loadAllLinks() {
    if (!db) {
        db = await openDB();
        if (!db) {
            allLinks = [];
            return allLinks;
        }
    }

    return new Promise((resolve, reject) => {
        if (!db.objectStoreNames.contains(STORE_NAME)) {
            console.warn(`Object store ${STORE_NAME} not found. Returning empty list.`);
            allLinks = [];
            return resolve(allLinks);
        }
        
        const transaction = db.transaction([STORE_NAME], 'readonly');
        const objectStore = transaction.objectStore(STORE_NAME);
        const request = objectStore.getAll();

        request.onerror = (event) => {
            console.error("Error retrieving links:", event.target.error);
            allLinks = []; 
            resolve(allLinks);
        };

        request.onsuccess = (event) => {
            allLinks = event.target.result.sort((a, b) => {
                const cat = a.category.localeCompare(b.category);
                if (cat !== 0) return cat;
                return a.sortOrder - b.sortOrder;
            });
            resolve(allLinks);
        };
    });
}


// ======================
// CLOCK FUNCTION
// ======================
function updateClock() {
    const clockElement = document.getElementById('welcomeClock');
    if (clockElement) {
        const now = new Date();
        const timeOptions = { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true };
        const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

        const formattedTime = now.toLocaleTimeString(undefined, timeOptions);
        const formattedDate = now.toLocaleDateString(undefined, dateOptions);

        clockElement.innerHTML = `${formattedDate}<br>${formattedTime}`;
    }
}


// ======================
// RENDER & ACTIVATION
// ======================
function activateTab(categoryName) {
    activeCategory = categoryName;

    // Target both fixed and scrollable tabs
    document.querySelectorAll('.ribbon-tabs-fixed .tab, .ribbon-tabs-scrollable .tab').forEach(tab => {
        if (tab.getAttribute('data-category') === categoryName) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });

    // Panel activation remains the same
    document.querySelectorAll('#linksContainer .panel').forEach(panel => {
        // The ID of the static panel is panel-ALL_LINKS_VIEW
        const panelId = panel.id.replace('panel-', '');
        if (panelId === categoryName.replace(/\s/g, '_')) {
            panel.classList.add('active');
        } else {
            panel.classList.remove('active');
        }
    });
}

/**
 * Creates a standard HTML link list for dynamic categories.
 */
function createLinkList(items) {
    const ul = document.createElement('ul');
    ul.className = 'link-list';
    
    // Logic for empty dynamic categories
    if (items.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.textContent = `No shortcuts in this category yet.`;
        ul.appendChild(empty);
        return ul;
    }

    // Link item generation loop
    items.forEach(item => {
        const li = document.createElement('li');
        li.className = 'link-list-item';
        
        const a = document.createElement('a');
        a.className = 'link-item-anchor';
        a.href = item.link;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.dataset.id = item.id;
        
        a.setAttribute('data-bs-toggle', 'tooltip');
        a.setAttribute('data-bs-placement', 'right');
        a.setAttribute('data-bs-title', item.link);

        // Icon creation logic
        const iconDiv=document.createElement('div');
        iconDiv.className='icon';
        
        const faviconExists = item.favicon_link !== undefined && item.favicon_link !== null;
        const fallbackText = (item.label || '').charAt(0).toUpperCase();

        if (faviconExists) {
            const trimmed = item.favicon_link.trim();

            if (trimmed === "") {
                iconDiv.textContent = fallbackText;
            }
            else if (trimmed === "...") {
                let domain;
                try {
                    domain = new URL(item.link).hostname.replace(/^www\./, '');
                } catch {
                    domain = '';
                }
                if (domain) {
                    const googleFavicon = `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
                    const img = document.createElement('img');
                    img.src = googleFavicon;
                    img.alt = item.label || 'Icon';
                    img.onload = function() {
                      if (/chrome.*\.png$/.test(this.src) || /icons\/product\/chrome/.test(this.src)) {
                        iconDiv.innerHTML = fallbackText;
                      } else {
                        iconDiv.classList.add('has-favicon');
                        iconDiv.appendChild(this);
                      }
                    };
                    img.onerror = () => {
                      iconDiv.innerHTML = fallbackText;
                    };
                    iconDiv.textContent = fallbackText;
                } else {
                    iconDiv.textContent = fallbackText;
                }
            }
            else {
                const img = document.createElement('img');
                img.src = trimmed;
                img.alt = item.label || 'Icon';
                img.onerror = () => {
                    let domain;
                    try {
                        domain = new URL(item.link).hostname.replace(/^www\./, '');
                    } catch {
                        domain = '';
                    }
                    if (domain) {
                        const googleFavicon = `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
                        const fallbackImg = document.createElement('img');
                        fallbackImg.src = googleFavicon;
                        fallbackImg.alt = item.label || 'Icon';
                        fallbackImg.onload = function() {
                            if (/chrome.*\.png$/.test(this.src) || /icons\/product\/chrome/.test(this.src)) {
                                iconDiv.innerHTML = fallbackText;
                            } else {
                                iconDiv.classList.add('has-favicon');
                                iconDiv.innerHTML = '';
                                iconDiv.appendChild(this);
                            }
                        };
                        fallbackImg.onerror = () => {
                            iconDiv.innerHTML = fallbackText;
                        };
                        iconDiv.innerHTML = '';
                        iconDiv.appendChild(fallbackImg);
                    } else {
                        iconDiv.innerHTML = fallbackText;
                    }
                };
                iconDiv.classList.add('has-favicon');
                iconDiv.appendChild(img);
            }
        } else {
            iconDiv.textContent = fallbackText;
        }

        // Color application logic
        if(item.color){
            iconDiv.style.backgroundColor=item.color;
            const hex = item.color.substring(1);
            const r = parseInt(hex.substring(0,2),16);
            const g = parseInt(hex.substring(2,4),16);
            const b = parseInt(hex.substring(4,6),16);
            const isDark = (r*0.299 + g*0.587 + b*0.114)/255 < 0.5;
            iconDiv.style.color = isDark ? '#fff' : '#111';
        }

        const linkTextDiv = document.createElement('div');
        linkTextDiv.className = 'link-text';
        
        const title=document.createElement('div');
        title.className='title';
        title.textContent=item.label||item.link;

        const urlDiv=document.createElement('div');
        urlDiv.className='url';
        urlDiv.textContent=item.link;
        
        // Assemble the parts
        linkTextDiv.appendChild(title);
        linkTextDiv.appendChild(urlDiv);

        a.appendChild(iconDiv);
        a.appendChild(linkTextDiv);

        li.appendChild(a);
        ul.appendChild(li);
    });
    
    return ul;
}

async function renderAll(){
    tooltipInstances.forEach(tooltip => tooltip.dispose());
    tooltipInstances = [];
    
    const sortedItems = allLinks;
    const linksContainer = document.getElementById('linksContainer');
    const fixedCategoryTab = document.getElementById('fixedCategoryTab');
    const scrollableCategoryTabs = document.getElementById('scrollableCategoryTabs');
    
    scrollableCategoryTabs.innerHTML=''; 
    fixedCategoryTab.innerHTML='';

    // Remove old dynamically created panels (preserve the static one: panel-ALL_LINKS_VIEW)
    document.querySelectorAll('#linksContainer .panel:not(#panel-ALL_LINKS_VIEW)').forEach(panel => panel.remove());


    let categories = [...new Set(allLinks.map(x => x.category))].sort((a, b) => a.localeCompare(b));
    
    
    // 1. STATIC "WELCOME" TAB (Fixed) - Creation
    const allLinksTab = document.createElement('li');
    allLinksTab.className = 'tab';
    
    allLinksTab.innerHTML = `
      <img src="${EPERFORMAX_ICON_URL}" alt="E-Performax Icon" width="16" height="16" style="margin-top: -1px;"/>
      Welcome
    `;
    
    allLinksTab.setAttribute('data-category', ALL_LINKS_VIEW);
    allLinksTab.onclick = () => activateTab(ALL_LINKS_VIEW);
    fixedCategoryTab.appendChild(allLinksTab); 

    // 2. DYNAMIC CATEGORY TABS (Scrollable) - Creation
    for(const cat of categories){
        const catItems = sortedItems.filter(x => x.category === cat);
        const panelId = `panel-${cat.replace(/\s/g, '_')}`;

        const tabLi = document.createElement('li');
        tabLi.className = 'tab';
        tabLi.textContent = cat;
        tabLi.setAttribute('data-category', cat);
        tabLi.onclick = () => activateTab(cat);
        scrollableCategoryTabs.appendChild(tabLi); 

        // 3. Create Dynamic Panel
        const panelDiv = document.createElement('div');
        panelDiv.className = 'panel';
        panelDiv.id = panelId;
        
        panelDiv.appendChild(createLinkList(catItems)); 
        linksContainer.appendChild(panelDiv);
    }
    
    // 4. Activate the correct tab/panel after creation
    if (!categories.includes(activeCategory) && activeCategory !== ALL_LINKS_VIEW) {
        activeCategory = ALL_LINKS_VIEW; 
    }

    activateTab(activeCategory);

    // Reinitialize tooltips for new elements
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    tooltipInstances = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
}


// ======================
// INIT
// ======================
document.addEventListener('DOMContentLoaded', async () => {
  // Load links from IndexedDB
  await loadAllLinks();
  
  // Set default view to 'All Links'
  activeCategory = ALL_LINKS_VIEW;
  
  await renderAll();

  // Initial clock update and set interval
  updateClock();
  setInterval(updateClock, 1000); 

  // --- MOUSE WHEEL SCROLLING LOGIC (Applied only to the scrollable section) ---
  const scrollableTabs = document.getElementById('scrollableCategoryTabs');
  if (scrollableTabs) {
    scrollableTabs.addEventListener('wheel', (event) => {
      if (Math.abs(event.deltaY) > Math.abs(event.deltaX)) {
        event.preventDefault(); 
        scrollableTabs.scrollLeft += event.deltaY;
      }
    }, { passive: false }); 
  }
  // ----------------------------------------
});
</script>

</body>
</html>